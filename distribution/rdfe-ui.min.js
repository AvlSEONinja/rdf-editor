(function(e){e.editors.List=e.editors.Base.extend({events:{'click [data-action="add"]:last':function(e){e.preventDefault(),this.addItem(null,!0)}},initialize:function(t){t=t||{};var n=e.editors;n.Base.prototype.initialize.call(this,t);var r=this.schema;if(!r)throw new Error("Missing required option 'schema'");this.template=t.template||this.constructor.template,this.Editor=function(){var e=r.itemType;return e?n.List[e]?n.List[e]:n[e]:n.Text}(),this.items=[]},render:function(){var e=this,t=this.value||[],n=Backbone.$,r=n(n.trim(this.template()));return this.$list=r.is("[data-items]")?r:r.find("[data-items]"),t.length?_.each(t,function(t){e.addItem(t)}):this.Editor.isAsync||this.addItem(),e.schema.maxCardinality&&e.items.length>=e.schema.maxCardinality&&r.find('button[data-action="add"]:last').hide(),this.setElement(r),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this),this},addItem:function(t,n){var r=this,i=e.editors,s=(new i.List.Item({list:this,form:this.form,schema:this.schema,value:t,Editor:this.Editor,key:this.key})).render(),o=function(){r.items.push(s),r.$list.append(s.el),r.schema.maxCardinality&&r.items.length>=r.schema.maxCardinality&&r.$el.find('button[data-action="add"]:last').hide(),s.editor.on("all",function(e){if(e==="change")return;var t=_.toArray(arguments);t[0]="item:"+e,t.splice(1,0,r),i.List.prototype.trigger.apply(this,t)},r),s.editor.on("change",function(){s.addEventTriggered||(s.addEventTriggered=!0,this.trigger("add",this,s.editor)),this.trigger("item:change",this,s.editor),this.trigger("change",this)},r),s.editor.on("focus",function(){if(this.hasFocus)return;this.trigger("focus",this)},r),s.editor.on("blur",function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(_.find(e.items,function(e){return e.editor.hasFocus}))return;e.trigger("blur",e)},0)},r);if(n||t)s.addEventTriggered=!0;n&&(r.trigger("add",r,s.editor),r.trigger("change",r))};return this.Editor.isAsync?s.editor.on("readyToAdd",o,this):(o(),s.editor.focus()),s},removeItem:function(e){var t=this.schema.confirmDelete;if(t&&!confirm(t))return;var n=_.indexOf(this.items,e);this.items[n].remove(),this.items.splice(n,1),e.addEventTriggered&&(this.trigger("remove",this,e.editor),this.trigger("change",this)),!this.items.length&&!this.Editor.isAsync&&this.addItem(),this.schema.maxCardinality&&this.items.length<this.schema.maxCardinality&&this.$el.find('button[data-action="add"]:last').show()},getValue:function(){var e=_.map(this.items,function(e){return e.getValue()});return _.without(e,undefined,"")},setValue:function(e){this.value=e,this.render()},focus:function(){if(this.hasFocus)return;this.items[0]&&this.items[0].editor.focus()},blur:function(){if(!this.hasFocus)return;var e=_.find(this.items,function(e){return e.editor.hasFocus});e&&e.editor.blur()},remove:function(){_.invoke(this.items,"remove"),e.editors.Base.prototype.remove.call(this)},validate:function(){if(!this.validators)return null;var e=_.map(this.items,function(e){return e.validate()}),t=_.compact(e).length?!0:!1;if(!t)return null;var n={type:"list",message:"Some of the items in the list failed validation",errors:e};return n}},{template:_.template('      <div>        <div data-items></div>        <button type="button" data-action="add">Add</button>      </div>    ',null,e.templateSettings)}),e.editors.List.Item=e.editors.Base.extend({events:{'click [data-action="remove"]:last':function(e){e.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function(e){if(e.keyCode!==13)return;e.preventDefault()}},initialize:function(t){this.list=t.list,this.schema=t.schema||this.list.schema,this.value=t.value,this.Editor=t.Editor||e.editors.Text,this.key=t.key,this.template=t.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=t.errorClassName||this.constructor.errorClassName,this.form=t.form},render:function(){var e=Backbone.$;this.editor=(new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form})).render();var t=e(e.trim(this.template()));return t.find("[data-editor]").append(this.editor.el),this.setElement(t),this},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var e=this.getValue(),t=this.list.form?this.list.form.getValue():{},n=this.schema.validators,r=this.getValidator;if(!n)return null;var i=null;return _.every(n,function(n){return i=r(n)(e,t),i?!1:!0}),i?this.setError(i):this.clearError(),i?i:null},setError:function(e){this.$el.addClass(this.errorClassName),this.$el.attr("title",e.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{template:_.template('      <div>        <span data-editor></span>        <button type="button" data-action="remove">&times;</button>      </div>    ',null,e.templateSettings),errorClassName:"error"}),e.editors.List.Modal=e.editors.Base.extend({events:{click:"openEditor"},initialize:function(t){t=t||{},e.editors.Base.prototype.initialize.call(this,t);if(!e.editors.List.Modal.ModalAdapter)throw new Error("A ModalAdapter is required");this.form=t.form;if(!t.form)throw new Error('Missing required option: "form"');this.template=t.template||this.constructor.template},render:function(){var e=this;return _.isEmpty(this.value)?this.openEditor():(this.renderSummary(),setTimeout(function(){e.trigger("readyToAdd")},0)),this.hasFocus&&this.trigger("blur",this),this},renderSummary:function(){this.$el.html($.trim(this.template({summary:this.getStringValue()})))},itemToString:function(t){var n=function(t){var n={key:t};return e.Field.prototype.createTitle.call(n)};t=t||{};var r=[];return _.each(this.nestedSchema,function(e,i){var s=e.title?e.title:n(i),o=t[i];if(_.isUndefined(o)||_.isNull(o))o="";r.push(s+": "+o)}),r.join("<br />")},getStringValue:function(){var e=this.schema,t=this.getValue();return _.isEmpty(t)?"[Empty]":e.itemToString?e.itemToString(t):this.itemToString(t)},openEditor:function(){var t=this,n=this.form.constructor,r=this.modalForm=new n({schema:this.nestedSchema,data:this.value}),i=this.modal=new e.editors.List.Modal.ModalAdapter({content:r,animate:!0});i.open(),this.trigger("open",this),this.trigger("focus",this),i.on("cancel",this.onModalClosed,this),i.on("ok",_.bind(this.onModalSubmitted,this))},onModalSubmitted:function(){var e=this.modal,t=this.modalForm,n=!this.value,r=t.validate();if(r)return e.preventClose();this.value=t.getValue(),this.renderSummary(),n&&this.trigger("readyToAdd"),this.trigger("change",this),this.onModalClosed()},onModalClosed:function(){this.modal=null,this.modalForm=null,this.trigger("close",this),this.trigger("blur",this)},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){if(this.hasFocus)return;this.openEditor()},blur:function(){if(!this.hasFocus)return;this.modal&&this.modal.trigger("cancel")}},{template:_.template("      <div><%= summary %></div>    ",null,e.templateSettings),ModalAdapter:Backbone.BootstrapModal,isAsync:!0}),e.editors.List.Object=e.editors.List.Modal.extend({initialize:function(){e.editors.List.Modal.prototype.initialize.apply(this,arguments);var t=this.schema;if(!t.subSchema)throw new Error('Missing required option "schema.subSchema"');this.nestedSchema=t.subSchema}}),e.editors.List.NestedModel=e.editors.List.Modal.extend({initialize:function(){e.editors.List.Modal.prototype.initialize.apply(this,arguments);var t=this.schema;if(!t.model)throw new Error('Missing required option "schema.model"');var n=t.model.prototype.schema;this.nestedSchema=_.isFunction(n)?n():n},getStringValue:function(){var e=this.schema,t=this.getValue();return _.isEmpty(t)?null:e.itemToString?e.itemToString(t):(new e.model(t)).toString()}})})(Backbone.Form),function(e){e.template=_.template('    <form class="form-horizontal" role="form">      <div data-fieldsets></div>      <% if (submitButton) { %>        <button type="submit" class="btn"><%= submitButton %></button>      <% } %>    </form>  '),e.Fieldset.template=_.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  "),e.Field.template=_.template('    <div class="form-group field-<%= key %>">      <label class="col-sm-2 control-label" for="<%= editorId %>">        <% if (titleHTML){ %><%= titleHTML %>        <% } else { %><%- title %><% } %>      </label>      <div class="col-sm-10">        <span data-editor></span>        <p class="help-block" data-error></p>        <p class="help-block"><%= help %></p>      </div>    </div>  '),e.NestedField.template=_.template('    <div class="field-<%= key %>">      <div title="<% if (titleHTML){ %><%= titleHTML %><% } else { %><%- title %><% } %>" class="input-xlarge">        <span data-editor></span>        <div class="help-inline" data-error></div>      </div>      <div class="help-block"><%= help %></div>    </div>  '),e.editors.Base.prototype.className="form-control",e.Field.errorClassName="has-error",e.editors.List&&(e.editors.List.template=_.template('      <div class="bbf-list">        <div class="bbf-list-contents">          <ul class="list-unstyled clearfix" data-items></ul>        </div>        <div class="bbf-list-buttons">          <button type="button" class="btn btn-default bbf-add" data-action="add"><span class="glyphicon glyphicon-plus"></span> add value</button>        </div>      </div>    '),e.editors.List.Item.template=_.template('      <li class="clearfix">        <div class="input-group">          <div data-editor></div>          <span class="input-group-btn">            <button type="button" class="btn btn-default bbf-del" data-action="remove">&times;</button>          </span>        </div>      </li>    '),e.editors.List.Object.template=e.editors.List.NestedModel.template=_.template('      <div class="bbf-list-modal"><%= summary %></div>    '))}(Backbone.Form),!function(e){"use strict";var t=function(e){var t=arguments,n=!0,r=1;return e=e.replace(/%s/g,function(){var e=t[r++];return typeof e=="undefined"?(n=!1,""):e}),n?e:""},n=function(t,n,r,i){var s="";return e.each(t,function(e,t){return t[n]===i?(s=t[r],!1):!0}),s},r=function(t,n){var r=-1;return e.each(t,function(e,t){return t.field===n?(r=e,!1):!0}),r},i=function(){var t=e("<p/>").addClass("fixed-table-scroll-inner"),n=e("<div/>").addClass("fixed-table-scroll-outer"),r,i;return n.append(t),e("body").append(n),r=t[0].offsetWidth,n.css("overflow","scroll"),i=t[0].offsetWidth,r===i&&(i=n[0].clientWidth),n.remove(),r-i},s=function(t,n,r,i){if(typeof n=="string"){var s=n.split(".");s.length>1?(n=window,e.each(s,function(e,t){n=n[t]})):n=window[n]}return typeof n=="object"?n:typeof n=="function"?n.apply(t,r):i},o=function(e){return typeof e=="string"?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e},u=function(t,n){this.options=n,this.$el=e(t),this.$el_=this.$el.clone(),this.timeoutId_=0,this.init()};u.DEFAULTS={classes:"table table-hover",height:undefined,undefinedText:"-",sortName:undefined,sortOrder:"asc",striped:!1,columns:[],data:[],method:"get",url:undefined,cache:!0,contentType:"application/json",dataType:"json",ajaxOptions:{},queryParams:function(e){return e},queryParamsType:"limit",responseHandler:function(e){return e},pagination:!1,sidePagination:"client",totalRows:0,pageNumber:1,pageSize:10,pageList:[10,25,50,100],search:!1,searchAlign:"right",selectItemName:"btSelectItem",showHeader:!0,showColumns:!1,showPaginationSwitch:!1,showRefresh:!1,showToggle:!1,buttonsAlign:"right",smartDisplay:!0,minimumCountColumns:1,idField:undefined,cardView:!1,trimOnSearch:!0,clickToSelect:!1,singleSelect:!1,toolbar:undefined,toolbarAlign:"left",checkboxHeader:!0,sortable:!0,maintainSelected:!1,searchTimeOut:500,iconSize:undefined,iconsPrefix:"glyphicon",icons:{paginationSwitchDown:"glyphicon-collapse-down icon-chevron-down",paginationSwitchUp:"glyphicon-collapse-up icon-chevron-up",refresh:"glyphicon-refresh icon-refresh",toggle:"glyphicon-list-alt icon-list-alt",columns:"glyphicon-th icon-th"},rowStyle:function(e,t){return{}},rowAttributes:function(e,t){return{}},onAll:function(e,t){return!1},onClickRow:function(e,t){return!1},onDblClickRow:function(e,t){return!1},onSort:function(e,t){return!1},onCheck:function(e){return!1},onUncheck:function(e){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onLoadSuccess:function(e){return!1},onLoadError:function(e){return!1},onColumnSwitch:function(e,t){return!1},onPageChange:function(e,t){return!1},onSearch:function(e){return!1},onPreBody:function(e){return!1},onPostBody:function(){return!1}},u.LOCALES=[],u.LOCALES["en-US"]={formatLoadingMessage:function(){return"Loading, please wait..."},formatRecordsPerPage:function(e){return t("%s records per page",e)},formatShowingRows:function(e,n,r){return t("Showing %s to %s of %s rows",e,n,r)},formatSearch:function(){return"Search"},formatNoMatches:function(){return"No matching records found"},formatPaginationSwitch:function(){return"Hide/Show pagination"},formatRefresh:function(){return"Refresh"},formatToggle:function(){return"Toggle"},formatColumns:function(){return"Columns"}},e.extend(u.DEFAULTS,u.LOCALES["en-US"]),u.COLUMN_DEFAULTS={radio:!1,checkbox:!1,checkboxEnabled:!0,field:undefined,title:undefined,"class":undefined,align:undefined,halign:undefined,valign:undefined,width:undefined,sortable:!1,order:"asc",visible:!0,switchable:!0,clickToSelect:!0,formatter:undefined,events:undefined,sorter:undefined,cellStyle:undefined,searchable:!0},u.EVENTS={"all.bs.table":"onAll","click-row.bs.table":"onClickRow","dbl-click-row.bs.table":"onDblClickRow","sort.bs.table":"onSort","check.bs.table":"onCheck","uncheck.bs.table":"onUncheck","check-all.bs.table":"onCheckAll","uncheck-all.bs.table":"onUncheckAll","load-success.bs.table":"onLoadSuccess","load-error.bs.table":"onLoadError","column-switch.bs.table":"onColumnSwitch","page-change.bs.table":"onPageChange","search.bs.table":"onSearch","pre-body.bs.table":"onPreBody","post-body.bs.table":"onPostBody"},u.prototype.init=function(){this.initContainer(),this.initTable(),this.initHeader(),this.initData(),this.initToolbar(),this.initPagination(),this.initBody(),this.initServer()},u.prototype.initContainer=function(){this.$container=e(['<div class="bootstrap-table">','<div class="fixed-table-toolbar"></div>','<div class="fixed-table-container">','<div class="fixed-table-header"><table></table></div>','<div class="fixed-table-body">','<div class="fixed-table-loading">',this.options.formatLoadingMessage(),"</div>","</div>",'<div class="fixed-table-pagination"></div>',"</div>","</div>"].join("")),this.$container.insertAfter(this.$el),this.$container.find(".fixed-table-body").append(this.$el),this.$container.after('<div class="clearfix"></div>'),this.$loading=this.$container.find(".fixed-table-loading"),this.$el.addClass(this.options.classes),this.options.striped&&this.$el.addClass("table-striped")},u.prototype.initTable=function(){var t=this,n=[],r=[];this.$header=this.$el.find("thead"),this.$header.length||(this.$header=e("<thead></thead>").appendTo(this.$el)),this.$header.find("tr").length||this.$header.append("<tr></tr>"),this.$header.find("th").each(function(){var t=e.extend({},{title:e(this).html(),"class":e(this).attr("class")},e(this).data());n.push(t)}),this.options.columns=e.extend([],n,this.options.columns),e.each(this.options.columns,function(n,r){t.options.columns[n]=e.extend({},u.COLUMN_DEFAULTS,{field:n},r)});if(this.options.data.length)return;this.$el.find("tbody tr").each(function(){var n={};n._id=e(this).attr("id"),n._class=e(this).attr("class"),e(this).find("td").each(function(r){var i=t.options.columns[r].field;n[i]=e(this).html(),n["_"+i+"_id"]=e(this).attr("id"),n["_"+i+"_class"]=e(this).attr("class")}),r.push(n)}),this.options.data=r},u.prototype.initHeader=function(){var n=this,r=[],i=[];this.header={fields:[],styles:[],classes:[],formatters:[],events:[],sorters:[],cellStyles:[],clickToSelects:[],searchables:[]},e.each(this.options.columns,function(e,s){var o="",u="",a="",f="",l=t(' class="%s"',s["class"]),c=n.options.sortOrder||s.order,h=!0;if(!s.visible)return;u=t("text-align: %s; ",s.halign?s.halign:s.align),a=t("text-align: %s; ",s.align),f=t("vertical-align: %s; ",s.valign),f+=t("width: %spx; ",s.checkbox||s.radio?36:s.width),r.push(s),n.header.fields.push(s.field),n.header.styles.push(a+f),n.header.classes.push(l),n.header.formatters.push(s.formatter),n.header.events.push(s.events),n.header.sorters.push(s.sorter),n.header.cellStyles.push(s.cellStyle),n.header.clickToSelects.push(s.clickToSelect),n.header.searchables.push(s.searchable),i.push("<th",s.checkbox||s.radio?t(' class="bs-checkbox %s"',s["class"]||""):l,t(' style="%s"',u+f),">"),i.push(t('<div class="th-inner %s">',n.options.sortable&&s.sortable?"sortable":"")),o=s.title,n.options.sortName===s.field&&n.options.sortable&&s.sortable&&(o+=n.getCaretHtml()),s.checkbox&&(!n.options.singleSelect&&n.options.checkboxHeader&&(o='<input name="btSelectAll" type="checkbox" />'),n.header.stateField=s.field),s.radio&&(o="",n.header.stateField=s.field,n.options.singleSelect=!0),i.push(o),i.push("</div>"),i.push('<div class="fht-cell"></div>'),i.push("</th>")}),this.$header.find("tr").html(i.join("")),this.$header.find("th").each(function(t){e(this).data(r[t])}),this.$container.off("click","th").on("click","th",function(t){n.options.sortable&&e(this).data().sortable&&n.onSort(t)}),!this.options.showHeader||this.options.cardView?(this.$header.hide(),this.$container.find(".fixed-table-header").hide(),this.$loading.css("top",0)):(this.$header.show(),this.$container.find(".fixed-table-header").show(),this.$loading.css("top","37px")),this.$selectAll=this.$header.find('[name="btSelectAll"]'),this.$container.off("click",'[name="btSelectAll"]').on("click",'[name="btSelectAll"]',function(){var t=e(this).prop("checked");n[t?"checkAll":"uncheckAll"]()})},u.prototype.initData=function(e,t){t==="append"?this.data=this.data.concat(e):t==="prepend"?this.data=e.concat(this.data):this.data=e||this.options.data,this.options.data=this.data;if(this.options.sidePagination==="server")return;this.initSort()},u.prototype.initSort=function(){var t=this,n=this.options.sortName,r=this.options.sortOrder==="desc"?-1:1,i=e.inArray(this.options.sortName,this.header.fields);i!==-1&&this.data.sort(function(o,u){var a=o[n],f=u[n],l=s(t.header,t.header.sorters[i],[a,f]);if(l!==undefined)return r*l;e.isNumeric(a)&&(a=parseFloat(a)),e.isNumeric(f)&&(f=parseFloat(f));if(a===undefined||a===null)a="";if(f===undefined||f===null)f="";return e.isNumeric(a)&&e.isNumeric(f)?a<f?r*-1:r:a===f?0:a.localeCompare(f)===-1?r*-1:r})},u.prototype.onSort=function(t){var n=e(t.currentTarget),r=this.$header.find("th").eq(n.index());this.$header.add(this.$header_).find("span.order").remove(),this.options.sortName===n.data("field")?this.options.sortOrder=this.options.sortOrder==="asc"?"desc":"asc":(this.options.sortName=n.data("field"),this.options.sortOrder=n.data("order")==="asc"?"desc":"asc"),this.trigger("sort",this.options.sortName,this.options.sortOrder),n.add(r).data("order",this.options.sortOrder).find(".th-inner").append(this.getCaretHtml());if(this.options.sidePagination==="server"){this.initServer();return}this.initSort(),this.initBody()},u.prototype.initToolbar=function(){var n=this,r=[],i=0,o,u,a=0;this.$toolbar=this.$container.find(".fixed-table-toolbar").html(""),typeof this.options.toolbar=="string"&&e(t('<div class="bars pull-%s"></div>',this.options.toolbarAlign)).appendTo(this.$toolbar).append(e(this.options.toolbar)),r=[t('<div class="columns columns-%s btn-group pull-%s">',this.options.buttonsAlign,this.options.buttonsAlign)],typeof this.options.icons=="string"&&(this.options.icons=s(null,this.options.icons)),this.options.showPaginationSwitch&&r.push(t('<button class="btn btn-default" type="button" name="paginationSwitch" title="%s">',this.options.formatPaginationSwitch()),t('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.paginationSwitchDown),"</button>"),this.options.showRefresh&&r.push(t('<button class="btn btn-default'+(this.options.iconSize==undefined?"":" btn-"+this.options.iconSize)+'" type="button" name="refresh" title="%s">',this.options.formatRefresh()),t('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.refresh),"</button>"),this.options.showToggle&&r.push(t('<button class="btn btn-default'+(this.options.iconSize==undefined?"":" btn-"+this.options.iconSize)+'" type="button" name="toggle" title="%s">',this.options.formatToggle()),t('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.toggle),"</button>"),this.options.showColumns&&(r.push(t('<div class="keep-open btn-group" title="%s">',this.options.formatColumns()),'<button type="button" class="btn btn-default'+(this.options.iconSize==undefined?"":" btn-"+this.options.iconSize)+' dropdown-toggle" data-toggle="dropdown">',t('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.columns),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">'),e.each(this.options.columns,function(e,n){if(n.radio||n.checkbox)return;var i=n.visible?' checked="checked"':"";n.switchable&&(r.push(t('<li><label><input type="checkbox" data-field="%s" value="%s"%s> %s</label></li>',n.field,e,i,n.title)),a++)}),r.push("</ul>","</div>")),r.push("</div>"),(this.showToolbar||r.length>2)&&this.$toolbar.append(r.join("")),this.options.showPaginationSwitch&&this.$toolbar.find('button[name="paginationSwitch"]').off("click").on("click",e.proxy(this.togglePagination,this)),this.options.showRefresh&&this.$toolbar.find('button[name="refresh"]').off("click").on("click",e.proxy(this.refresh,this)),this.options.showToggle&&this.$toolbar.find('button[name="toggle"]').off("click").on("click",function(){n.options.cardView=!n.options.cardView,n.initHeader(),n.initBody()}),this.options.showColumns&&(o=this.$toolbar.find(".keep-open"),a<=this.options.minimumCountColumns&&o.find("input").prop("disabled",!0),o.find("li").off("click").on("click",function(e){e.stopImmediatePropagation()}),o.find("input").off("click").on("click",function(){var t=e(this);n.toggleColumn(t.val(),t.prop("checked"),!1),n.trigger("column-switch",e(this).data("field"),t.prop("checked"))})),this.options.search&&(r=[],r.push('<div class="pull-'+this.options.searchAlign+' search">',t('<input class="form-control'+(this.options.iconSize==undefined?"":" input-"+this.options.iconSize)+'" type="text" placeholder="%s">',this.options.formatSearch()),"</div>"),this.$toolbar.append(r.join("")),u=this.$toolbar.find(".search input"),u.off("keyup").on("keyup",function(e){clearTimeout(i),i=setTimeout(function(){n.onSearch(e)},n.options.searchTimeOut)}))},u.prototype.onSearch=function(t){var n=e.trim(e(t.currentTarget).val());this.options.trimOnSearch&&e(t.currentTarget).val(n);if(n===this.searchText)return;this.searchText=n,this.options.pageNumber=1,this.initSearch(),this.updatePagination(),this.trigger("search",n)},u.prototype.initSearch=function(){var t=this;if(this.options.sidePagination!=="server"){var n=this.searchText&&this.searchText.toLowerCase(),r=e.isEmptyObject(this.filterColumns)?null:this.filterColumns;this.data=r?e.grep(this.options.data,function(e,t){for(var n in r)if(e[n]!==r[n])return!1;return!0}):this.options.data,this.data=n?e.grep(this.data,function(r,i){for(var o in r){o=e.isNumeric(o)?parseInt(o,10):o;var u=r[o];u=s(t.header,t.header.formatters[e.inArray(o,t.header.fields)],[u,r,i],u);var a=e.inArray(o,t.header.fields);if(a!==-1&&t.header.searchables[a]&&(typeof u=="string"||typeof u=="number")&&(u+"").toLowerCase().indexOf(n)!==-1)return!0}return!1}):this.data}},u.prototype.initPagination=function(){this.$pagination=this.$container.find(".fixed-table-pagination");if(!this.options.pagination){this.$pagination.hide();return}this.$pagination.show();var n=this,r=[],i,s,o,u,a,f,l,c,h,p=this.getData();this.options.sidePagination!=="server"&&(this.options.totalRows=p.length),this.totalPages=0,this.options.totalRows&&(this.totalPages=~~((this.options.totalRows-1)/this.options.pageSize)+1,this.options.totalPages=this.totalPages),this.totalPages>0&&this.options.pageNumber>this.totalPages&&(this.options.pageNumber=this.totalPages),this.pageFrom=(this.options.pageNumber-1)*this.options.pageSize+1,this.pageTo=this.options.pageNumber*this.options.pageSize,this.pageTo>this.options.totalRows&&(this.pageTo=this.options.totalRows),r.push('<div class="pull-left pagination-detail">','<span class="pagination-info">',this.options.formatShowingRows(this.pageFrom,this.pageTo,this.options.totalRows),"</span>"),r.push('<span class="page-list">');var d=['<span class="btn-group dropup">','<button type="button" class="btn btn-default '+(this.options.iconSize==undefined?"":" btn-"+this.options.iconSize)+' dropdown-toggle" data-toggle="dropdown">','<span class="page-size">',this.options.pageSize,"</span>",' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">'],v=this.options.pageList;if(typeof this.options.pageList=="string"){var m=this.options.pageList.replace("[","").replace("]","").replace(/ /g,"").split(",");v=[],e.each(m,function(e,t){v.push(+t)})}e.each(v,function(e,r){if(!n.options.smartDisplay||e===0||v[e-1]<=n.options.totalRows){var i=r===n.options.pageSize?' class="active"':"";d.push(t('<li%s><a href="javascript:void(0)">%s</a></li>',i,r))}}),d.push("</ul></span>"),r.push(this.options.formatRecordsPerPage(d.join(""))),r.push("</span>"),r.push("</div>",'<div class="pull-right pagination">','<ul class="pagination'+(this.options.iconSize==undefined?"":" pagination-"+this.options.iconSize)+'">','<li class="page-first"><a href="javascript:void(0)">&lt;&lt;</a></li>','<li class="page-pre"><a href="javascript:void(0)">&lt;</a></li>'),this.totalPages<5?(s=1,o=this.totalPages):(s=this.options.pageNumber-2,o=s+4,s<1&&(s=1,o=5),o>this.totalPages&&(o=this.totalPages,s=o-4));for(i=s;i<=o;i++)r.push('<li class="page-number'+(i===this.options.pageNumber?" active disabled":"")+'">','<a href="javascript:void(0)">',i,"</a>","</li>");r.push('<li class="page-next"><a href="javascript:void(0)">&gt;</a></li>','<li class="page-last"><a href="javascript:void(0)">&gt;&gt;</a></li>',"</ul>","</div>"),this.$pagination.html(r.join("")),u=this.$pagination.find(".page-list a"),a=this.$pagination.find(".page-first"),f=this.$pagination.find(".page-pre"),l=this.$pagination.find(".page-next"),c=this.$pagination.find(".page-last"),h=this.$pagination.find(".page-number"),this.options.pageNumber<=1&&(a.addClass("disabled"),f.addClass("disabled")),this.options.pageNumber>=this.totalPages&&(l.addClass("disabled"),c.addClass("disabled")),this.options.smartDisplay&&(this.totalPages<=1&&this.$pagination.find("div.pagination").hide(),(this.options.pageList.length<2||this.options.totalRows<=this.options.pageList[0])&&this.$pagination.find("span.page-list").hide(),this.$pagination[this.getData().length?"show":"hide"]()),u.off("click").on("click",e.proxy(this.onPageListChange,this)),a.off("click").on("click",e.proxy(this.onPageFirst,this)),f.off("click").on("click",e.proxy(this.onPagePre,this)),l.off("click").on("click",e.proxy(this.onPageNext,this)),c.off("click").on("click",e.proxy(this.onPageLast,this)),h.off("click").on("click",e.proxy(this.onPageNumber,this))},u.prototype.updatePagination=function(t){if(t&&e(t.currentTarget).hasClass("disabled"))return;this.options.maintainSelected||this.resetRows(),this.initPagination(),this.options.sidePagination==="server"?this.initServer():this.initBody(),this.trigger("page-change",this.options.pageNumber,this.options.pageSize)},u.prototype.onPageListChange=function(t){var n=e(t.currentTarget);n.parent().addClass("active").siblings().removeClass("active"),this.options.pageSize=+n.text(),this.$toolbar.find(".page-size").text(this.options.pageSize),this.updatePagination(t)},u.prototype.onPageFirst=function(e){this.options.pageNumber=1,this.updatePagination(e)},u.prototype.onPagePre=function(e){this.options.pageNumber--,this.updatePagination(e)},u.prototype.onPageNext=function(e){this.options.pageNumber++,this.updatePagination(e)},u.prototype.onPageLast=function(e){this.options.pageNumber=this.totalPages,this.updatePagination(e)},u.prototype.onPageNumber=function(t){if(this.options.pageNumber===+e(t.currentTarget).text())return;this.options.pageNumber=+e(t.currentTarget).text(),this.updatePagination(t)},u.prototype.initBody=function(i){var u=this,a=[],f=this.getData();this.trigger("pre-body",f),this.$body=this.$el.find("tbody"),this.$body.length||(this.$body=e("<tbody></tbody>").appendTo(this.$el));if(!this.options.pagination||this.options.sidePagination==="server")this.pageFrom=1,this.pageTo=f.length;for(var l=this.pageFrom-1;l<this.pageTo;l++){var c=f[l],h={},p=[],d={},v=[];h=s(this.options,this.options.rowStyle,[c,l],h);if(h&&h.css)for(var m in h.css)p.push(m+": "+h.css[m]);d=s(this.options,this.options.rowAttributes,[c,l],d);if(d)for(var m in d)v.push(t('%s="%s"',m,o(d[m])));a.push("<tr",t(" %s",v.join(" ")),t(' id="%s"',e.isArray(c)?undefined:c._id),t(' class="%s"',h.classes||(e.isArray(c)?undefined:c._class)),t(' data-index="%s"',l),">"),this.options.cardView&&a.push(t('<td colspan="%s">',this.header.fields.length)),e.each(this.header.fields,function(e,i){var o="",f=c[i],d="",v={},m="",g=u.header.classes[e],y=u.options.columns[r(u.options.columns,i)];h=t('style="%s"',p.concat(u.header.styles[e]).join("; ")),f=s(u.header,u.header.formatters[e],[f,c,l],f),c["_"+i+"_id"]&&(m=t(' id="%s"',c["_"+i+"_id"])),c["_"+i+"_class"]&&(g=t(' class="%s"',c["_"+i+"_class"])),v=s(u.header,u.header.cellStyles[e],[f,c,l],v),v.classes&&(g=t(' class="%s"',v.classes));if(v.css){var b=[];for(var w in v.css)b.push(w+": "+v.css[w]);h=t('style="%s"',b.concat(u.header.styles[e]).join("; "))}if(y.checkbox||y.radio){if(u.options.cardView)return!0;d=y.checkbox?"checkbox":d,d=y.radio?"radio":d,o=['<td class="bs-checkbox">',"<input"+t(' data-index="%s"',l)+t(' name="%s"',u.options.selectItemName)+t(' type="%s"',d)+t(' value="%s"',c[u.options.idField])+t(' checked="%s"',f===!0||f&&f.checked?"checked":undefined)+t(' disabled="%s"',!y.checkboxEnabled||f&&f.disabled?"disabled":undefined)+" />","</td>"].join("")}else f=typeof f=="undefined"||f===null?u.options.undefinedText:f,o=u.options.cardView?['<div class="card-view">',u.options.showHeader?t('<span class="title" %s>%s</span>',h,n(u.options.columns,"field","title",i)):"",t('<span class="value">%s</span>',f),"</div>"].join(""):[t("<td%s %s %s>",m,g,h),f,"</td>"].join(""),u.options.cardView&&u.options.smartDisplay&&f===""&&(o="");a.push(o)}),this.options.cardView&&a.push("</td>"),a.push("</tr>")}a.length||a.push('<tr class="no-records-found">',t('<td colspan="%s">%s</td>',this.header.fields.length,this.options.formatNoMatches()),"</tr>"),this.$body.html(a.join("")),i||this.scrollTo(0),this.$body.find("> tr > td").off("click").on("click",function(){var n=e(this).parent();u.trigger("click-row",u.data[n.data("index")],n),u.options.clickToSelect&&u.header.clickToSelects[n.children().index(e(this))]&&n.find(t('[name="%s"]',u.options.selectItemName))[0].click()}),this.$body.find("tr").off("dblclick").on("dblclick",function(){u.trigger("dbl-click-row",u.data[e(this).data("index")],e(this))}),this.$selectItem=this.$body.find(t('[name="%s"]',this.options.selectItemName)),this.$selectItem.off("click").on("click",function(t){t.stopImmediatePropagation();var n=e(this).prop("checked"),r=u.data[e(this).data("index")];r[u.header.stateField]=n,u.trigger(n?"check":"uncheck",r),u.options.singleSelect&&(u.$selectItem.not(this).each(function(){u.data[e(this).data("index")][u.header.stateField]=!1}),u.$selectItem.filter(":checked").not(this).prop("checked",!1)),u.updateSelected()}),e.each(this.header.events,function(t,n){if(!n)return;typeof n=="string"&&(n=s(null,n));for(var r in n)u.$body.find("tr").each(function(){var i=e(this),s=i.find(u.options.cardView?".card-view":"td").eq(t),o=r.indexOf(" "),a=r.substring(0,o),f=r.substring(o+1),l=n[r];s.find(f).off(a).on(a,function(e){var n=i.data("index"),r=u.data[n],s=r[u.header.fields[t]];l.apply(this,[e,s,r,n])})})}),this.updateSelected(),this.resetView(),this.trigger("post-body")},u.prototype.initServer=function(t,n){var r=this,i={},o={pageSize:this.options.pageSize,pageNumber:this.options.pageNumber,searchText:this.searchText,sortName:this.options.sortName,sortOrder:this.options.sortOrder};if(!this.options.url)return;this.options.queryParamsType==="limit"&&(o={search:o.searchText,sort:o.sortName,order:o.sortOrder},this.options.pagination&&(o.limit=this.options.pageSize,o.offset=this.options.pageSize*(this.options.pageNumber-1))),i=s(this.options,this.options.queryParams,[o],i),e.extend(i,n||{});if(i===!1)return;t||this.$loading.show(),e.ajax(e.extend({},s(null,this.options.ajaxOptions),{type:this.options.method,url:this.options.url,data:this.options.contentType==="application/json"&&this.options.method==="post"?JSON.stringify(i):i,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:function(e){e=s(r.options,r.options.responseHandler,[e],e),r.load(e),r.trigger("load-success",e)},error:function(e){r.trigger("load-error",e.status)},complete:function(){t||r.$loading.hide()}}))},u.prototype.getCaretHtml=function(){return['<span class="order'+(this.options.sortOrder==="desc"?"":" dropup")+'">','<span class="caret" style="margin: 10px 5px;"></span>',"</span>"].join("")},u.prototype.updateSelected=function(){var t=this.$selectItem.filter(":enabled").length===this.$selectItem.filter(":enabled").filter(":checked").length;this.$selectAll.add(this.$selectAll_).prop("checked",t),this.$selectItem.each(function(){e(this).parents("tr")[e(this).prop("checked")?"addClass":"removeClass"]("selected")})},u.prototype.updateRows=function(t){var n=this;this.$selectItem.each(function(){n.data[e(this).data("index")][n.header.stateField]=t})},u.prototype.resetRows=function(){var t=this;e.each(this.data,function(e,n){t.$selectAll.prop("checked",!1),t.$selectItem.prop("checked",!1),n[t.header.stateField]=!1})},u.prototype.trigger=function(t){var n=Array.prototype.slice.call(arguments,1);t+=".bs.table",this.options[u.EVENTS[t]].apply(this.options,n),this.$el.trigger(e.Event(t),n),this.options.onAll(t,n),this.$el.trigger(e.Event("all.bs.table"),[t,n])},u.prototype.resetHeader=function(){var t=this,n=this.$container.find(".fixed-table-header"),r=this.$container.find(".fixed-table-body"),s=this.$el.width()>r.width()?i():0;if(this.$el.is(":hidden")){clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(e.proxy(this.resetHeader,this),100);return}this.$header_=this.$header.clone(!0,!0),this.$selectAll_=this.$header_.find('[name="btSelectAll"]'),setTimeout(function(){n.css({height:"37px","border-bottom":"1px solid #dddddd","margin-right":s}).find("table").css("width",t.$el.css("width")).html("").attr("class",t.$el.attr("class")).append(t.$header_),t.$header.find("th").each(function(n){t.$header_.find("th").eq(n).data(e(this).data())}),t.$body.find("tr:first-child:not(.no-records-found) > *").each(function(n){t.$header_.find("div.fht-cell").eq(n).width(e(this).innerWidth())}),t.$el.css("margin-top",-t.$header.height()),r.off("scroll").on("scroll",function(){n.scrollLeft(e(this).scrollLeft())})})},u.prototype.toggleColumn=function(e,n,r){if(e===-1)return;this.options.columns[e].visible=n,this.initHeader(),this.initSearch(),this.initPagination(),this.initBody();if(this.options.showColumns){var i=this.$toolbar.find(".keep-open input").prop("disabled",!1);r&&i.filter(t('[value="%s"]',e)).prop("checked",n),i.filter(":checked").length<=this.options.minimumCountColumns&&i.filter(":checked").prop("disabled",!0)}},u.prototype.resetView=function(e){var t=this,n=this.header;e&&e.height&&(this.options.height=e.height),this.$selectAll.prop("checked",this.$selectItem.length>0&&this.$selectItem.length===this.$selectItem.filter(":checked").length);if(this.options.height){var r=+this.$toolbar.children().outerHeight(!0),i=+this.$pagination.children().outerHeight(!0),s=this.options.height-r-i;this.$container.find(".fixed-table-container").css("height",s+"px")}if(this.options.cardView){t.$el.css("margin-top","0"),t.$container.find(".fixed-table-container").css("padding-bottom","0");return}this.options.showHeader&&this.options.height&&this.resetHeader(),this.options.height&&this.options.showHeader&&this.$container.find(".fixed-table-container").css("padding-bottom","37px")},u.prototype.getData=function(){return this.searchText||!e.isEmptyObject(this.filterColumns)?this.data:this.options.data},u.prototype.load=function(e){this.options.sidePagination==="server"&&(this.options.totalRows=e.total,e=e.rows),this.initData(e),this.initSearch(),this.initPagination(),this.initBody()},u.prototype.append=function(e){this.initData(e,"append"),this.initSearch(),this.initPagination(),this.initBody(!0)},u.prototype.prepend=function(e){this.initData(e,"prepend"),this.initSearch(),this.initPagination(),this.initBody(!0)},u.prototype.remove=function(t){var n=this.options.data.length,r,i;if(!t.hasOwnProperty("field")||!t.hasOwnProperty("values"))return;for(r=n-1;r>=0;r--){i=this.options.data[r];if(!i.hasOwnProperty(t.field))return;e.inArray(i[t.field],t.values)!==-1&&this.options.data.splice(r,1)}if(n===this.options.data.length)return;this.initSearch(),this.initPagination(),this.initBody(!0)},u.prototype.update=function(t){var n=this.data.length,r,i;if(!t.hasOwnProperty("field")||!t.hasOwnProperty("data"))return;for(r=n-1;r>=0;r--){i=this.data[r];if(!i.hasOwnProperty(t.field))return;if(i[t.field]===t.data[t.field]){e.extend(this.data[r],t.data);break}}this.initBody(!0)},u.prototype.insertRow=function(e){if(!e.hasOwnProperty("index")||!e.hasOwnProperty("row"))return;this.data.splice(e.index,0,e.row),this.initBody(!0)},u.prototype.updateRow=function(t){if(!t.hasOwnProperty("index")||!t.hasOwnProperty("row"))return;e.extend(this.data[t.index],t.row),this.initBody(!0)},u.prototype.mergeCells=function(t){var n=t.index,r=e.inArray(t.field,this.header.fields),i=t.rowspan||1,s=t.colspan||1,o,u,a=this.$body.find("tr"),f=a.eq(n).find("td").eq(r);if(n<0||r<0||n>=this.data.length)return;for(o=n;o<n+i;o++)for(u=r;u<r+s;u++)a.eq(o).find("td").eq(u).hide();f.attr("rowspan",i).attr("colspan",s).show()},u.prototype.getOptions=function(){return this.options},u.prototype.getSelections=function(){var t=this;return e.grep(this.data,function(e){return e[t.header.stateField]})},u.prototype.checkAll=function(){this.checkAll_(!0)},u.prototype.uncheckAll=function(){this.checkAll_(!1)},u.prototype.checkAll_=function(e){this.$selectItem.filter(":enabled").prop("checked",e),this.updateRows(e),this.updateSelected(),this.trigger(e?"check-all":"uncheck-all")},u.prototype.check=function(e){this.check_(!0,e)},u.prototype.uncheck=function(e){this.check_(!1,e)},u.prototype.check_=function(e,n){this.$selectItem.filter(t('[data-index="%s"]',n)).prop("checked",e),this.data[n][this.header.stateField]=e,this.updateSelected()},u.prototype.destroy=function(){this.$el.insertBefore(this.$container),e(this.options.toolbar).insertBefore(this.$el),this.$container.next().remove(),this.$container.remove(),this.$el.html(this.$el_.html()).css("margin-top","0").attr("class",this.$el_.attr("class")||"")},u.prototype.showLoading=function(){this.$loading.show()},u.prototype.hideLoading=function(){this.$loading.hide()},u.prototype.togglePagination=function(){this.options.pagination=!this.options.pagination;var e=this.$toolbar.find('button[name="paginationSwitch"] i');this.options.pagination?e.attr("class",this.options.iconsPrefix+" "+this.options.icons.paginationSwitchDown):e.attr("class",this.options.iconsPrefix+" "+this.options.icons.paginationSwitchUp),this.updatePagination()},u.prototype.refresh=function(e){e&&e.url&&(this.options.url=e.url,this.options.pageNumber=1),this.initServer(e&&e.silent,e&&e.query)},u.prototype.showColumn=function(e){this.toggleColumn(r(this.options.columns,e),!0,!0)},u.prototype.hideColumn=function(e){this.toggleColumn(r(this.options.columns,e),!1,!0)},u.prototype.filterBy=function(t){this.filterColumns=e.isEmptyObject(t)?{}:t,this.options.pageNumber=1,this.initSearch(),this.updatePagination()},u.prototype.scrollTo=function(e){var t=this.$container.find(".fixed-table-body");typeof e=="string"&&(e=e==="bottom"?t[0].scrollHeight:0),typeof e=="number"&&t.scrollTop(e)},u.prototype.selectPage=function(e){e>0&&e<=this.options.totalPages&&(this.options.pageNumber=e,this.updatePagination())},u.prototype.prevPage=function(){this.options.pageNumber>1&&(this.options.pageNumber--,this.updatePagination())},u.prototype.nextPage=function(){this.options.pageNumber<this.options.totalPages&&(this.options.pageNumber++,this.updatePagination())},u.prototype.toggleView=function(){this.options.cardView=!this.options.cardView,this.initHeader(),this.initBody()};var a=["getOptions","getSelections","getData","load","append","prepend","remove","insertRow","updateRow","mergeCells","checkAll","uncheckAll","check","uncheck","refresh","resetView","destroy","showLoading","hideLoading","showColumn","hideColumn","filterBy","scrollTo","selectPage","prevPage","nextPage","togglePagination","toggleView","update"];e.fn.bootstrapTable=function(t,n){var r;return this.each(function(){var i=e(this),s=i.data("bootstrap.table"),o=e.extend({},u.DEFAULTS,i.data(),typeof t=="object"&&t);if(typeof t=="string"){if(e.inArray(t,a)<0)throw"Unknown method: "+t;if(!s)return;r=s[t](n),t==="destroy"&&i.removeData("bootstrap.table")}s||i.data("bootstrap.table",s=new u(this,o))}),typeof r=="undefined"?this:r},e.fn.bootstrapTable.Constructor=u,e.fn.bootstrapTable.defaults=u.DEFAULTS,e.fn.bootstrapTable.columnDefaults=u.COLUMN_DEFAULTS,e.fn.bootstrapTable.locales=u.LOCALES,e.fn.bootstrapTable.methods=a,e(function(){e('[data-toggle="table"]').bootstrapTable()})}(jQuery),!function(e){"use strict";e.extend(e.fn.bootstrapTable.defaults,{editable:!0,onEditableInit:function(){return!1}}),e.extend(e.fn.bootstrapTable.Constructor.EVENTS,{"editable-init.bs.table":"onEditableInit"});var t=e.fn.bootstrapTable.Constructor,n=t.prototype.initTable,r=t.prototype.initBody;t.prototype.initTable=function(){var t=this;n.apply(this,Array.prototype.slice.apply(arguments));if(!this.options.editable)return;e.each(this.options.columns,function(e,n){if(!n.editable)return;var r=n.formatter;n.formatter=function(e,i,s){var o=r?r(e,i,s):e;return['<a href="javascript:void(0)"',' data-name="'+n.field+'"',' data-pk="'+i[t.options.idField]+'"',">"+o+"</a>"].join("")}})},t.prototype.initBody=function(){var t=this;r.apply(this,Array.prototype.slice.apply(arguments));if(!this.options.editable)return;e.each(this.options.columns,function(n,r){if(!r.editable)return;var i=t.getData();t.$body.find('a[data-name="'+r.field+'"]').each(function(){if(typeof r.editable=="function"){var t=i[e(this).parents("tr[data-index]").data("index")];e(this).editable(r.editable(t,r.field))}else e(this).editable(r.editable)}).off("save").on("save",function(n,s){var o=i[e(this).parents("tr[data-index]").data("index")];t.options.dataSetter?t.options.dataSetter(o,r.field,s.newValue):o[r.field]=s.newValue})}),this.trigger("editable-init")}}(jQuery),function(e){var n={type:null,showLangSelect:!0,selectize:!1,create:!0},r=function(e,t,n,r,i,s){var o=parseInt(e,10);return isNaN(o)?!1:!t&&o==0?!1:!n&&o<0?!1:!r&&o>0?!1:i!=undefined&&o>i?!1:s!=undefined&&o<s?!1:!0},i=function(t){return e.isNumeric(t)},s={"http://www.w3.org/2000/01/rdf-schema#Literal":{label:"Plain Literal"},"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource":{label:"Reference"},"http://www.w3.org/2001/XMLSchema#integer":{label:"Integer",verify:function(e){return r(e,!0,!0,!0)}},"http://www.w3.org/2001/XMLSchema#decimal":{label:"Decimal",verify:i},"http://www.w3.org/2001/XMLSchema#double":{label:"Double",verify:i},"http://www.w3.org/2001/XMLSchema#float":{label:"Float",verify:i},"http://www.w3.org/2001/XMLSchema#nonPositiveInteger":{label:"Non-Positive Integer",verify:function(e){return r(e,!0,!0,!1)}},"http://www.w3.org/2001/XMLSchema#negativeInteger":{label:"Negative Integer",verify:function(e){return r(e,!1,!0,!1)}},"http://www.w3.org/2001/XMLSchema#long":{label:"Long",verify:function(e){return r(e,!0,!0,!0)}},"http://www.w3.org/2001/XMLSchema#int":{label:"Int",verify:function(e){return r(e,!0,!0,!0,2147483647,-2147483648)}},"http://www.w3.org/2001/XMLSchema#short":{label:"Short",verify:function(e){return r(e,!0,!0,!0,32767,-32768)}},"http://www.w3.org/2001/XMLSchema#byte":{label:"Byte",verify:function(e){return r(e,!0,!0,!0,127,-128)}},"http://www.w3.org/2001/XMLSchema#nonNegativeInteger":{label:"Non-Negative Integer",verify:function(e){return r(e,!0,!1,!0)}},"http://www.w3.org/2001/XMLSchema#unsignedLong":{label:"Unsigned Long",verify:function(e){return r(e,!0,!1,!0)}},"http://www.w3.org/2001/XMLSchema#unsignedInt":{label:"Unsigned Int",verify:function(e){return r(e,!0,!1,!0,4294967295)}},"http://www.w3.org/2001/XMLSchema#unsignedShort":{label:"Unsigned Short",verify:function(e){return r(e,!0,!1,!0,65535)}},"http://www.w3.org/2001/XMLSchema#unsignedByte":{label:"Unsigned Byte",verify:function(e){return r(e,!0,!0,!0,255)}},"http://www.w3.org/2001/XMLSchema#positiveInteger":{label:"Positive Integer",verify:function(e){return r(e,!1,!1,!0)}},"http://www.w3.org/2001/XMLSchema#boolean":{label:"Boolean",setup:function(e,t){t?(e.bootstrapToggle&&e.bootstrapToggle("destroy"),e.attr("type","text")):(e.bootstrapToggle&&e.bootstrapToggle({on:"True",off:"False"}),e.attr("type","checkbox"))},getValue:function(e){return e.is(":checked")?"true":"false"},setValue:function(e,t){parseInt(t)==1||typeof t=="string"&&t.toLowerCase()=="true"?e.attr("checked","checked"):e.removeAttr("checked")}},"http://www.w3.org/2001/XMLSchema#string":{label:"String"},"http://www.w3.org/2001/XMLSchema#dateTime":{label:"Datetime",setup:function(e,t){t?e.datetimepicker("remove"):e.datetimepicker({format:"yyyy-mm-ddThh:ii:ssZ",weekStart:1})}},"http://www.w3.org/2001/XMLSchema#date":{label:"Date",setup:function(e,t){t?e.datetimepicker("remove"):e.datetimepicker({format:"yyyy-mm-dd",weekStart:1})}}},o=function(r,i){var o=this;o.mainElem=r,o.options=e.extend({},n,i),o.currentType=o.options.type||"http://www.w3.org/2000/01/rdf-schema#Literal",o.mainElem.on("input",function(){o.verifyInput(),o.change()}),o.container=e(document.createElement("div")).addClass("rdfNodeEditor"),o.inputContainer=e(document.createElement("div")).addClass("rdfNodeInputContainer");var u=e(r).addClass("form-control");u.after(o.container),o.inputContainer.append(u),o.container.append(o.inputContainer);if(o.options.choices){o.resSelect=e(document.createElement("select")),o.inputContainer.append(o.resSelect),o.mainElem.hide();var a=function(e){var t=[];for(var n=0;n<e.length;n++){var r=RDFE.RdfNode.fromStoreNode(e[n]);r.label=e[n].label||r.value,t.push(r)}o.resSelect.selectize({valueField:"value",searchField:"label",sortField:"label",options:t,create:o.options.create?function(e,t){var n=new RDFE.RdfNode("uri",e);n.label=e,this.options[e]=n,t(n)}:!1,createOnBlur:!0,onChange:function(e){o.mainElem.val(e),o.change()},render:{item:function(e,t){return"<div>"+t(e.label||e.value)+"</div>"},option:function(e,t){return e.label?"<div>"+t(e.label)+" <small>("+t(e.value)+")</small></div>":"<div>"+t(e.value)+"</div>"}}})};typeof o.options.choices=="object"?a(o.options.choices):typeof o.options.choices=="function"&&o.options.choices(function(e){a(e)})}o.langElem=e(document.createElement("input")).addClass("form-control").attr("placeholder","Language"),o.langContainer=e(document.createElement("div")).addClass("rdfNodeLangContainer"),o.langContainer.append(o.langElem),o.container.append(o.langContainer),o.currentType!="http://www.w3.org/2000/01/rdf-schema#Literal"&&o.langContainer.hide(),o.langElem.on("input",function(){o.lang=o.langElem.val(),o.verifyInput(),o.change()}),o.options.showLangSelect||o.langContainer.hide(),o.typeContainer=e(document.createElement("div")).addClass("rdfNodeTypeContainer"),o.typeElem=e(document.createElement("select")).addClass("form-control");for(t in s)o.typeElem.append(e(document.createElement("option")).attr("value",t).text(s[t].label));o.typeContainer.append(o.typeElem),o.container.append(o.typeContainer);var f=function(){o.lastType=o.currentType,o.currentType=o.options.selectize?o.typeElem[0].selectize.getValue():o.typeElem.val(),o.verifyFct=s[o.currentType].verify,o.updateEditor(),o.verifyInput(),o.change()};o.options.selectize?(o.typeElem.selectize({onChange:f}),o.typeElem[0].selectize.setValue(this.currentType)):o.typeElem.change(f),o.options.type&&(o.typeElem.val(o.options.type),o.typeContainer.hide()),o.updateEditor(!0)};o.prototype.change=function(){e(this).trigger("change",this)};var u=function(){var t=["http://www.w3.org/2000/01/rdf-schema#Literal","http://www.w3.org/2001/XMLSchema#string"];return function(n,r){return n===r||e.inArray(n,t)>=0&&e.inArray(r,t)>=0}}();o.prototype.updateEditor=function(e){u(this.options.type,this.currentType)?this.typeContainer.hide():this.typeContainer.css("display","table-cell"),!this.options.showLangSelect||this.currentType!="http://www.w3.org/2000/01/rdf-schema#Literal"?this.langContainer.hide():this.langContainer.css("display","table-cell");if(e||this.lastType!=this.currentType)this.lastType&&s[this.lastType].setup&&s[this.lastType].setup(this.mainElem,!0),s[this.currentType].setup&&s[this.currentType].setup(this.mainElem)},o.prototype.getValue=function(){return this.currentType=="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"?new RDFE.RdfNode("uri",this.mainElem.val()):new RDFE.RdfNode("literal",s[this.currentType].getValue?s[this.currentType].getValue(this.mainElem):this.mainElem.val(),this.currentType!="http://www.w3.org/2000/01/rdf-schema#Literal"?this.currentType:undefined,this.lang?this.lang:undefined)},o.prototype.setValue=function(e){if(e){var t=RDFE.RdfNode.fromStoreNode(e);this.lastType=this.currentType;var n=t.type;n==="uri"?this.currentType="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource":(this.currentType=t.datatype||"http://www.w3.org/2000/01/rdf-schema#Literal",this.options.type==="http://www.w3.org/2001/XMLSchema#boolean"&&(t.value==="0"||t.value==="1")&&(this.currentType="http://www.w3.org/2001/XMLSchema#boolean")),this.lang=t.language,t.value.indexOf("\n")!==-1&&this.transformToTextarea(),this.mainElem.val(t.value),this.resSelect&&(this.resSelect[0].selectize.addOption(t),this.resSelect[0].selectize.setValue(t.value)),s[this.currentType].setValue&&s[this.currentType].setValue(this.mainElem,this.mainElem.val()),this.langElem.val(this.lang),this.typeElem.val(this.currentType),this.options.selectize&&this.typeElem[0].selectize.setValue(this.currentType),this.updateEditor()}},o.prototype.isValid=function(e){return this.verifyFct?this.verifyFct(this.mainElem.val()):!0},o.prototype.verifyInput=function(){var t=this,n=e(this.mainElem).val(),r=!0;n.length>0&&(r=this.verifyFct?this.verifyFct(n):!0),r?t.mainElem.removeClass("has-error"):t.mainElem.addClass("has-error")},o.prototype.isLiteralType=function(e){return s.hasOwnProperty(e)&&e!="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"},o.prototype.setEditFocus=function(){this.mainElem.focus()},o.prototype.blur=function(){this.mainElem.blur()},o.prototype.getElement=function(){return this.container},o.prototype.transformToTextarea=function(){var t=this;if(t.mainElem.prop("tagName")==="INPUT"&&t.mainElem.prop("type")==="text"){var n=t.mainElem.val();textArea=document.createElement("textarea"),textArea.id=t.mainElem.prop("id"),textArea.name=t.mainElem.prop("name"),e(textArea).addClass(t.mainElem.prop("class")),textArea.value=n,t.mainElem.replaceWith(textArea),t.mainElem=e(textArea)}},e.fn.rdfNodeEditor=function(e){var t=this.data("rdfNodeEditor");return t||(t=new o(this,e),this.data("rdfNodeEditor",t)),t}}(jQuery),function(e){"use strict";var t=function(e){this.init("rdfnode",e,t.defaults)};e.fn.editableutils.inherit(t,e.fn.editabletypes.abstractinput),e.extend(t.prototype,{render:function(){this.$input=this.$tpl.filter("input"),this.setClass(),this.$input.rdfNodeEditor(this.options.rdfnode)},activate:function(){this.$input.rdfNodeEditor().setEditFocus()},value2html:function(t,n){if(!t){e(n).empty();return}e(n).text(t.toString())},html2value:function(e){return null},input2value:function(){return this.$input.rdfNodeEditor().getValue()},value2input:function(e){this.$input.rdfNodeEditor().setValue(e)}}),t.defaults=e.extend({},e.fn.editabletypes.abstractinput.defaults,{rdfnode:{},tpl:'<input type="text">'}),e.fn.editabletypes.rdfnode=t}(window.jQuery),function(e){var t=function(t,n){var r=this;r.options=e.extend({},n),r.options.ontoManager=r.options.ontoManager||new RDFE.OntologyManager,r.mainElem=t,e(ontologyManager).on("changed",function(e,t){r.sel.addOption(t.allOntologies())}),e(r.mainElem).selectize({valueField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:r.options.ontoManager.ontologies,onChange:function(t){e(r).trigger("changed",r.options.ontoManager.ontologyByURI(t))},create:function(e,t){var n=r.options.ontoManager.ontologyDetermine(e);n||(n=r.options.ontoManager.prefixes[e]||e),r.options.ontoManager.ontologyParse(n,{success:function(e){t(e)},error:function(){t(null)}})},render:{item:function(e,t){return"<div>"+t(e.title||e.label||e.prefix||e.URI)+"</div>"},option:function(e,t){return"<div>"+t(e.title||e.label||e.prefix||e.URI)+"<br/><small>("+t(e.URI)+")</small></div>"},option_create:function(e,t){var n=r.options.ontoManager.prefixes[e.input]||e.input;return n!=e.input?'<div class="create">Load <strong>'+t(e.input)+"</strong> <small>("+t(n)+")</small>&hellip;</div>":'<div class="create">Load <strong>'+t(n)+"</strong>&hellip;</div>"}}}),r.sel=e(r.mainElem)[0].selectize};t.prototype.selectedOntologyURI=function(){return this.sel.getValue()},t.prototype.selectedOntology=function(){return this.sel.options[this.selectedOntologyURI()]},t.prototype.on=function(t,n){e(this).on(t,n)},e.fn.ontoBox=function(e){var n=this.data("ontoBox");return n||(n=new t(this,e),this.data("ontoBox",n)),n}}(jQuery),function(e){var t=function(n,r){var i=this;i.options=e.extend({},t.defaults,r),i.options.ontoManager=i.options.ontoManager||new RDFE.OntologyManager,i.mainElem=n,e(ontologyManager).on("ontologyLoaded",function(e,t,n){i.updateOptions()}),e(i.mainElem).selectize({valueField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:i.propertyList(),onChange:function(t){e(i).trigger("changed",i.sel.options[t])},create:function(e,t){t(i.options.ontoManager.ontologyPropertyByURI(i.options.ontoManager.uriDenormalize(e),!0))},render:{item:function(e,t){var n=e.title||e.label||name.curi||e.name;return e.curi&&e.curi!=n?n=t(n)+" <small>("+t(e.curi)+")</small>":n=t(n),"<div>"+n+"</div>"},option:function(e,t){return"<div>"+t(e.title||e.label||name.curi||e.name)+"<br/><small>("+t(e.URI)+")</small></div>"},option_create:function(e,t){var n=i.options.ontoManager.uriDenormalize(e.input);return n!=e.input?'<div class="create">Add <strong>'+t(e.input)+"</strong> <small>("+t(n)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+t(n)+"</strong>&hellip;</div>"}}}),i.sel=e(i.mainElem)[0].selectize};t.defaults={ontoManager:null,ontology:null},t.prototype.setOntology=function(e){console.log("setOntology",e),this.options.ontology=e,this.updateOptions()},t.prototype.propertyList=function(){return console.log("propertyList",this.options),this.options.ontology?this.options.ontology.allProperties():this.options.ontoManager.allProperties()},t.prototype.updateOptions=function(){var e=this.propertyList();this.sel.clearOptions(),this.sel.addOption(e)},t.prototype.setPropertyURI=function(e){console.log("PropertyBox.setPropertyURI",e);if(e){var t=this.options.ontoManager.uriDenormalize(e);this.sel.options[t]||this.sel.addOption(this.options.ontoManager.OntologyProperty(null,t)),this.sel.setValue(t)}else this.sel.setValue(null)},t.prototype.selectedURI=function(){return this.sel.getValue()},t.prototype.selectedProperty=function(){return this.sel.options[this.selectedURI()]},t.prototype.on=function(t,n){return e(this).on(t,n),this},e.fn.propertyBox=function(e){var n=this.data("propertyBox");return n||(n=new t(this,e),this.data("propertyBox",n)),n}}(jQuery),function(e){"use strict";var t=function(e){this.init("rdfnode",e,t.defaults)};e.fn.editableutils.inherit(t,e.fn.editabletypes.abstractinput),e.extend(t.prototype,{render:function(){this.$input=this.$tpl.filter("select"),this.setClass(),this.$input.propertyBox(this.options.propertyBox),this.$input.propertyBox().sel.$control.css("min-width","250px")},activate:function(){},value2html:function(t,n){if(!t){e(n).empty();return}e(n).text(t.toString())},html2value:function(e){return null},input2value:function(){return this.$input.propertyBox().selectedURI()},value2input:function(e){this.$input.propertyBox().setPropertyURI(e)}}),t.defaults=e.extend({},e.fn.editabletypes.abstractinput.defaults,{propertyBox:{},tpl:"<select></select>"}),e.fn.editabletypes.propertyBox=t}(window.jQuery),function(e){window.RDFE||(window.RDFE={}),RDFE.TripleView=function(){var t=function(e,t){this.doc=e,this.ontologyManager=t},n=function(e){return e.interfaceName=="Literal"?e.datatype=="http://www.w3.org/2001/XMLSchema#dateTime"?(new Date(e.nominalValue)).toString():e.nominalValue:e.toString()};return t.prototype.render=function(t,r){var i=this,s=function(t,n,r){var s=r;n==="predicate"&&(s=i.doc.store.rdf.createNamedNode(r));if(r.toStoreNode)s=r.toStoreNode(i.doc.store);else if(n!="object"||t.object.interfaceName=="NamedNode")s=i.doc.store.rdf.createNamedNode(r);else if(t.object.datatype=="http://www.w3.org/2001/XMLSchema#dateTime"){var o=new Date(r);s=i.doc.store.rdf.createLiteral(o.toISOString(),t.object.language,t.object.datatype)}else s=i.doc.store.rdf.createLiteral(r,t.object.language,t.object.datatype);var u=i.doc.store.rdf.createTriple(t.subject,t.predicate,t.object);u[n]=s,i.doc.updateTriple(t,u,function(e){},function(t){e(i).trigger("rdf-editor-error",{message:"Failed to update triple in document: "+t})})};i.doc.listProperties(function(o){console.log("Found existing predicates: ",o),i.doc.store.graph(i.doc.graph,function(o,u){if(o){t.empty();var a=e(document.createElement("table")).addClass("table");t.append(a);var f=u.toArray();for(var l=0;l<f.length;l+=1)f[l].id=l;a.data("maxindex",l),a.bootstrapTable({striped:!0,sortName:"s",pagination:!0,search:!0,searchAlign:"left",showHeader:!0,editable:!0,data:f,dataSetter:s,columns:[{field:"subject",title:"Subject",aligh:"left",sortable:!0,editable:function(e){return{mode:"inline",type:"rdfnode",rdfnode:{type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"},value:e.subject}},formatter:n},{field:"predicate",title:"Predicate",align:"left",sortable:!0,editable:function(e){return{mode:"inline",type:"propertyBox",propertyBox:{ontoManager:i.ontologyManager},value:e.predicate.nominalValue}},formatter:n},{field:"object",title:"Object",align:"left",sortable:!0,editable:function(e){return{mode:"inline",type:"rdfnode",value:e.object}},formatter:n},{field:"actions",title:"Actions",align:"center",valign:"middle",clickToSelect:!1,editable:!1,formatter:function(e,t,n){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(t,n,r,s){var o=r;i.doc.deleteTriple(o,function(){a.bootstrapTable("remove",{field:"id",values:[r.id]})},function(){e(i).trigger("rdf-editor-error",{type:"triple-delete-failed",message:"Failed to delete triple."})})}}}]}),i.tripleTable=a,r&&r()}else e(i).trigger("rdf-editor-error","Failed to query triples from doc.")})})},t.prototype.addTriple=function(t){var n=this.tripleTable.data("maxindex");n+=1,this.tripleTable.bootstrapTable("append",e.extend(t,{id:n})),this.tripleTable.data("maxindex",n)},t}()}(jQuery),Backbone.Form.editors.Rdfnode=Backbone.Form.editors.Base.extend({tagName:"input",events:{change:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)},keyup:function(e,t){e.keyCode==13&&e.shiftKey&&(console.log("shift+enter"),this.editor&&this.editor.transformToTextarea(),e.stopPropagation()),this.trigger("keyup",this)}},initialize:function(e){Backbone.Form.editors.Base.prototype.initialize.call(this,e)},render:function(){var e=this;return this.$el.attr("type","text"),this.$el.rdfNodeEditor(this.schema.rdfnode),e.editor=this.$el.rdfNodeEditor(),e.setElement(e.editor.getElement()),$(this.editor).on("change",function(){e.trigger("change",this)}),this.setValue(this.value),this},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){if(this.hasFocus)return;this.editor.setEditFocus()},blur:function(){if(!this.hasFocus)return;this.editor.blur()}}),Backbone.Form.editors.NestedRdf=Backbone.Form.editors.Object.extend({initialize:function(e){Backbone.Form.editors.Base.prototype.initialize.call(this,e);if(!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedRdf editor')},render:function(){var e=this.form.constructor,t=this.value,n=this.key,r=this.schema.model,i=t?t:new r;return this.nestedForm=new e({model:i,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return{uri:this.nestedForm.model.uri,values:this.nestedForm.getValue()}}}),window.RDFE||(window.RDFE={}),RDFE.EntityModel=Backbone.Model.extend({setEntity:function(e,t){this.doc=e,this.uri=t,this.individualsCache={}},addValue:function(e,t){var n=this.get(e)||[];n.push(t),this.set(e,n)},getIndividuals:function(e,t){var n=this;if(this.individualsCache[e]){t(this.individualsCache[e]);return}var r=[],i=this.doc.ontologyManager.ontologyClassByURI(e);!e||e==="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"?r=this.doc.ontologyManager.individuals:e==="http://www.w3.org/2000/01/rdf-schema#Class"?r=this.doc.ontologyManager.ontologyClasses:e==="http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"?r=this.doc.ontologyManager.ontologyProperties:i&&(r=i.getIndividuals(!0)),r=_.map(_.values(r),function(e){var t=new RDFE.RdfNode("uri",e.URI);return t.label=e.label||e.name,t}),n.doc.listEntities(e,function(e){$.merge(r,e)});if(i){var s=i.getSubClasses(!0);for(var o=0,u=s.length;o<u;o++)n.doc.listEntities(s[o].URI,function(e){$.merge(r,e)})}this.individualsCache[e]=r,t(r)},maxCardinalityForProperty:function(e){for(var t=0;t<this.types.length;t++){var n=this.types[t].maxCardinalityForProperty(e);if(n)return n}return null},restrictionsForProperty:function(e){for(var t=0;t<this.types.length;t++){var n=this.types[t].restrictions[e];if(n)return n}return null},isAggregateProperty:function(e){for(var t=0;t<this.types.length;t++)if(this.types[t].isAggregateProperty(e))return!0;return!1},addSchemaEntryForProperty:function(e){var t=this,n=e.URI?e:t.doc.ontologyManager.ontologyProperties[e]||{URI:e},r=this.restrictionsForProperty(e),i,s;r&&(i=r.hasCustomLabel,s=r.hasCustomComment);var o=RDFE.Utils.createTitle(i||n.label||n.title||RDFE.Utils.uri2name(n.URI)),u={titleHTML:'<span title="{0}">{1}</span>'.format(RDFE.Utils.escapeXml(n.URI),o),title:o,maxCardinality:t.maxCardinalityForProperty(n.URI),editorAttrs:{title:RDFE.coalesce(s,n.comment,n.description)}};if(t.isAggregateProperty(n.URI)){var a=n.getRange?t.doc.ontologyManager.ontologyClassByURI(n.getRange()):null;a?(u.type="List",u.itemType="NestedRdf",u.model=RDFE.EntityModel.extend({defaults:{"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":[n.getRange()]},initialize:function(e){RDFE.EntityModel.prototype.initialize.call(this,e),this.doc=t.doc,this.buildSchemaFromTypes([a])},individualsCache:t.individualsCache}),u.editorAttrs.style="height:auto;"):(console.log("Caution: invalid range on aggregate: ",n),u.type="List",u.itemType="Rdfnode",u.rdfnode={type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",create:!0})}else{u.type="List",u.itemType="Rdfnode",u.rdfnode={};var f=_.result(n,"getRange");n.class==t.doc.ontologyManager.uriDenormalize("owl:DatatypeProperty")?u.rdfnode.type=f:n.class==t.doc.ontologyManager.uriDenormalize("owl:ObjectProperty")?(u.rdfnode.type="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",u.rdfnode.choices=function(e){t.getIndividuals(f,e)},u.rdfnode.create=!0):f&&(f=="http://www.w3.org/2000/01/rdf-schema#Literal"||f.startsWith("http://www.w3.org/2001/XMLSchema#")?u.rdfnode.type=f:(u.rdfnode.type="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",u.rdfnode.choices=function(e){t.getIndividuals(f,e)},u.rdfnode.create=!0))}t.schema[n.URI]=u},buildSchemaFromTypes:function(e){var t=this;t.schema={},t.fields=[],t.lens=null,t.types=e;for(var n=0,r=e.length;n<r;n++){var i=e[n].getFresnelLens();if(i&&i.showProperties.length){t.lens=i;break}}i?t.fields=_.without(i.showProperties,t.doc.ontologyManager.uriDenormalize("fresnel:allProperties")):t.fields=[t.doc.ontologyManager.uriDenormalize("rdf:type")];for(var n=0;n<t.fields.length;n++)t.addSchemaEntryForProperty(t.fields[n])},docToModel:function(e,t){var n=this;n.schema={},n.fields=[],n.ontologyManager=ontologyManager,this.doc.getEntity(n.uri,function(t){n.types=_.compact(_.map(t.types,n.doc.ontologyManager.ontologyClassByURI,n.doc.ontologyManager)),n.fields=[],n.lens=null;var r=[];if(n.types.length===0)for(var i in t.properties){var s=n.doc.ontologyManager.ontologyPropertyByURI(i);s&&s.domain&&(n.types=_.union(n.types,s.domain))}for(var o=0,u=n.types.length;o<u;o++){var a=n.types[o].getFresnelLens();if(a&&a.showProperties.length>0){n.lens=a;break}}a&&(n.fields=_.clone(a.showProperties));if(!a){n.allowAddProperty=!0;for(var i in t.properties)_.contains(n.fields,i)||(i==="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"?n.fields.unshift(i):n.fields.push(i))}else{var f=n.fields.indexOf(n.ontologyManager.uriDenormalize("fresnel:allProperties"));if(f>=0){n.allowAddProperty=!0;var l=[];for(i in t.properties)!_.contains(n.fields,i)&&!_.contains(a.hideProperties,i)&&l.push(i);n.fields.splice.apply(n.fields,[f,1].concat(l))}}for(var o=0;o<n.fields.length;o++)n.addSchemaEntryForProperty(n.fields[o]);for(var i in t.properties){var c=n.isAggregateProperty(i),h=t.properties[i];for(var o=0;o<h.length;o++)if(c){var p=new RDFE.EntityModel;p.setEntity(n.doc,h[o].value),p.individualsCache=n.individualsCache,p.docToModel(function(){n.addValue(i,p)})}else n.addValue(i,h[o])}e&&e()})},modelToDoc:function(){function t(n,r,i){var s=[];if(!n||n.length===0){var o="";for(var u=0,a=i.config.options.labelProps.length;u<a;u++)if(r[i.config.options.labelProps[u]]){o=r[i.config.options.labelProps[u]];break}o=(o||"subres")+"_"+e,n=i.buildEntityUri(o),e++}var f=i.store.rdf.createNamedNode(n);for(prop in r){var l=i.store.rdf.createNamedNode(prop),c=r[prop];c.constructor!==Array&&(c=[c]);for(var h=0;h<c.length;h++){var p=c[h];if(p.values){var d=t(p.uri,p.values,i);d.length>0&&(s.push(i.store.rdf.createTriple(f,l,d[0].subject)),Array.prototype.push.apply(s,d))}else{var v=c[h].toStoreNode(i.store);v&&v.nominalValue.length>0&&s.push(i.store.rdf.createTriple(f,l,v))}}}return s}var e=1;return function(n,r){var i=this;e=1;var s=t(this.uri,i.attributes,i.doc),o=[];for(var u=0;u<s.length;u++)_.indexOf(o,s[u].subject.nominalValue)<0&&o.push(s[u].subject.nominalValue);var a=function(e){e>=o.length?i.doc.addTriples(s,n,r):i.doc.deleteBySubject(o[e],function(){a(e+1)},r)};a(0)}}()}),function(e){window.RDFE||(window.RDFE={}),RDFE.EntityEditor=function(){var t=function(e,t){this.doc=e,this.ontologyManager=t},n=Backbone.Form.extend({template:_.template('        <form class="form-horizontal clearfix" role="form">          <a href="#" class="btn btn-default btn-xs pull-right addProp">Add Property</a>          <div data-fieldsets></div>          <% if (submitButton) { %>            <button type="submit" class="btn"><%= submitButton %></button>          <% } %>        </form>      '),render:function(){var t=this;return Backbone.Form.prototype.render.call(this),t.model.allowAddProperty||this.$el.find(".addProp").hide(),this.$el.find("> a.addProp").click(function(n){n.preventDefault();var r=e(document.createElement("select")),i=e(document.createElement("button")).addClass("btn").addClass("btn-default").text("Add"),s=e(document.createElement("button")).addClass("btn").addClass("btn-default").text("Cancel"),o=e(document.createElement("div")).append(e(document.createElement("span")).text("New Property:")).append(r).append(i).append(s);r=r.propertyBox({ontoManager:t.model.doc.ontologyManager}),s.click(function(e){e.preventDefault(),o.remove()}),i.click(function(e){e.preventDefault();if(r.selectedURI()){console.log("Adding new property",r.selectedURI(),"to form",t),t.commit(),t.model.addSchemaEntryForProperty(r.selectedProperty()),t.model.fields.push(r.selectedURI()),t.fieldsets=undefined,t.initialize(t.options),o.remove();var n=t.$el.parent();t.$el.remove(),t.render(),console.log(n,t.$el),n.append(t.$el)}else console.log("No prop selected")}),t.$el.prepend(o)}),this}});return t.prototype.template=_.template('<div class="panel panel-default">        <div class="panel-heading clearfix">          <h3 class="panel-title pull-left">Editing <a href="<%= entityUri %>"><span class="entity-label"><%= entityLabel %><span></a> <span class="entity-types"></span></h3>          <div class="btn-group pull-right" role="group">            <button type="button" class="btn btn-primary btn-sm" id="okBtn">Apply</button>            <button type="button" class="btn btn-default btn-sm" id="cnclBtn">Cancel</button>          </div>        </div>        <div class="panel-body" id="entityFormContainer">        </div>      </div>'),t.prototype.render=function(t,r,i){var s=this,o=new RDFE.EntityModel;o.setEntity(this.doc,r),o.docToModel(function(){var u=new n({model:o});u.render(),t.empty(),t.append(s.template({entityUri:r,entityLabel:RDFE.Utils.uri2name(r)})),s.doc.getEntity(r,function(e){t.find(".entity-types").html(s.ontologyManager.typesToLabel(e.types,!0)),t.find(".entity-label").html(e.label)}),t.find("#entityFormContainer").append(u.el),t.find(".toggle.btn").css("width","100%");var a=t.find("button#cnclBtn"),f=t.find("button#saveBtn"),l=t.find("button#okBtn");a.click(function(){i()});var c=function(t){u.commit(),o.modelToDoc(function(){e(s).trigger("rdf-editor-success",{type:"editor-form-save-done",message:"Locally saved details of "+r}),t&&t()},function(t){e(s).trigger("rdf-editor-error",{type:"editor-form-save-failed",message:t})})};f.click(function(){c()}),l.click(function(){c(i)})},function(t){e(s).trigger("rdf-editor-error",{type:"editor-form-creation-failed",message:t})})},t}()}(jQuery),function(e){window.RDFE||(window.RDFE={}),RDFE.EntityView=function(){var t=function(e,t,n){this.doc=e,this.ontologyManager=t,this.editFct=n.editFct},n=function(e,t,n){return t.types&&t.types.length?t.label+" <small>("+t.types+")</small>":t.label},r=function(e,t,n){return['<a class="edit ml10" href="javascript:void(0)" title="Edit">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},i=function(e,t){return{label:e.label,types:t.typesToLabel(e.types),uri:e.uri||e.value}};return t.prototype.render=function(t,s){var o=this;o.doc.listEntities(function(u){o.entityTable=null,t.empty();var a=e(document.createElement("table")).addClass("table");t.append(a);var f=[];for(var l=0;l<u.length;l++)f.push(i(u[l],o.ontologyManager));var c=function(t){o.doc.deleteEntity(t,function(){a.bootstrapTable("remove",{field:"uri",values:[t]}),e(o).trigger("rdf-editor-success",{type:"entity-delete-done",uri:t,message:"Successfully deleted entity "+t+"."})},function(t){e(o).trigger("rdf-editor-error",{type:"entity-delete-failed",message:t})})};a.bootstrapTable({striped:!0,sortName:"label",pagination:!0,search:!0,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:f,idField:"uri",columns:[{field:"label",title:"Entity Name",aligh:"left",sortable:!0,formatter:n},{field:"actions",title:"Actions",align:"center",valign:"middle",clickToSelect:!1,formatter:r,events:{"click .edit":function(e,t,n,r){o.editFct(n.uri)},"click .remove":function(e,t,n,r){c(n.uri)}}}]}),o.entityTable=a,s&&s()},function(t){e(o).trigger("rdf-editor-error",{type:"entity-list-failed",message:t})})},t.prototype.addEntity=function(e){this.entityTable.bootstrapTable("append",e)},t.prototype.updateEntity=function(e){var t=this;t.doc.getEntity(e,function(e){t.entityTable.bootstrapTable("update",{field:"uri",data:i(e,t.ontologyManager)})})},t}()}(jQuery),typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(e){return this.indexOf(e)==0}),window.RDFE||(window.RDFE={}),RDFE.Editor=function(e,t){var n=this,t=$.extend({initOntologyManager:!0},t);this.ontologyManager=new RDFE.OntologyManager(e.options),t.initOntologyManager===!0&&this.ontologyManager.init(),this.doc=new RDFE.Document(this.ontologyManager,e),this.config=e},RDFE.Editor.prototype.render=function(e){this.container=e,this.container.empty(),this.listContainer=$(document.createElement("div")).appendTo(this.container),this.formContainer=$(document.createElement("div")).appendTo(this.container),this.toggleView(this.config.options.defaultView)},RDFE.Editor.prototype.currentView=function(){return this._currentView},RDFE.Editor.prototype.toggleView=function(e){e!==this._currentView&&(e==="triples"?(this.createTripleList(),this._currentView="triples"):(this.createEntityList(),this._currentView="entities"))},RDFE.Editor.prototype.updateView=function(){this._currentView==="triples"?this.createTripleList():this._currentView==="entities"&&this.createEntityList()},RDFE.Editor.prototype.createTripleList=function(){var e=this;$(e).trigger("rdf-editor-start",{id:"render-triple-list",message:"Loading Triples..."}),this.tripleView||(this.tripleView=new RDFE.TripleView(this.doc,this.ontologyManager),$(e.tripleView).on("rdf-editor-error",function(t,n){$(e).trigger("rdf-editor-error",n)}).on("rdf-editor-success",function(t,n){$(e).trigger("rdf-editor-success",n)})),this.formContainer.hide(),this.listContainer.empty().show(),this.tripleView.render(e.listContainer,function(){$(e).trigger("rdf-editor-done",{id:"render-triple-list"})})},RDFE.Editor.prototype.createNewStatementEditor=function(){var e=this;if(!this.doc)return!1;e.listContainer.hide(),e.formContainer.html('       <div class="panel panel-default">       <div class="panel-heading"><h3 class="panel-title">Add new Triple</h3></div>       <div class="panel-body"><div class="form-horizontal">       <div class="form-group"><label for="subject" class="col-sm-2 control-label">Subject</label>       <div class="col-sm-10"><input name="subject" class="form-control" /></div></div>       <div class="form-group"><label for="predicate" class="col-sm-2 control-label">Predicate</label>       <div class="col-sm-10"><select name="predicate" class="form-control"></select></div></div>       <div class="form-group"><label for="object" class="col-sm-2 control-label">Object</label>       <div class="col-sm-10"><input name="object" class="form-control" /></div></div>       <div class="form-group"><div class="col-sm-10 col-sm-offset-2"><a href="#" class="btn btn-default triple-action triple-action-new-cancel">Cancel</a>         <a href="#" class="btn btn-primary triple-action triple-action-new-save">OK</a></div></div>       </form></div></div>\n').show();var t=e.formContainer.find('input[name="object"]').rdfNodeEditor(),n=e.formContainer.find('select[name="predicate"]').propertyBox({ontoManager:e.ontologyManager}).on("changed",function(n,r){console.log("changed",r);var i=t.getValue(),s,o=r.getRange();t.isLiteralType(o)?s=new RDFE.RdfNode("literal",i.value,o,i.language):e.ontologyManager.ontologyClassByURI(o)?s=new RDFE.RdfNode("uri",i.value):s=new RDFE.RdfNode("literal",i.value,null,""),t.setValue(s)});e.formContainer.find("a.triple-action-new-cancel").click(function(t){e.createTripleList()}),e.formContainer.find("a.triple-action-new-save").click(function(r){var i=e.formContainer.find('input[name="subject"]').val(),s=n.selectedURI(),o=t.getValue(),u=e.doc.store.rdf.createTriple(e.doc.store.rdf.createNamedNode(i),e.doc.store.rdf.createNamedNode(s),o.toStoreNode(e.doc.store));e.doc.addTriples([u],function(){e.tripleView&&e.tripleView.addTriple(u),$(e).trigger("rdf-editor-success",{type:"triple-insert-success",message:"Successfully added new triple."}),e.createTripleList()},function(){$(e).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new triple to store."})})})},RDFE.Editor.prototype.createNewEntityEditor=function(e){var t=this,n,r,i,s,o=function(e){var n=t.ontologyManager.ontologyByURI(e.currentTarget.selectedOntologyURI());s.clearOptions(),s.addOption(n?n.classesAsArray():t.ontologyManager.allClasses())};if(!this.doc)return!1;this.listContainer.hide(),this.formContainer.show();if(!e)t.formContainer.html('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Add new Entity</h3></div><div class="panel-body"><div class="form-horizontal">   <div class="form-group">     <label for="ontology" class="col-sm-2 control-label">Ontology</label>     <div class="col-sm-10">       <select name="ontology" id="ontology" class="form-control" />     </div>   </div>   <div class="form-group">     <label for="class" class="col-sm-2 control-label">Type</label>     <div class="col-sm-10">       <select name="class" id="class" class="form-control" />     </div>   </div>   <div class="form-group">      <label for="subject" class="col-sm-2 control-label">Entity URI</label>      <div class="col-sm-10">        <input name="subject" id="subject" class="form-control" />      </div>   </div>   <div class="form-group">     <div class="col-sm-10 col-sm-offset-2">       <a href="#" class="btn btn-default triple-action triple-action-new-cancel">Cancel</a>       <a href="#" class="btn btn-primary triple-action triple-action-new-save">OK</a>     </div>   </div> </div></div></div>\n'),r=$("#ontology").ontoBox({ontoManager:t.ontologyManager}),r.on("changed",o),r.sel.focus(),i=$("#class").selectize({create:!0,valueField:"URI",labelField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:t.ontologyManager.allClasses(),create:function(e,n){n(t.ontologyManager.OntologyClass(null,t.ontologyManager.uriDenormalize(e)))},render:{item:function(e,t){var n=e.title||e.label||name.curi||e.name;return e.curi&&e.curi!=n?n=t(n)+" <small>("+t(e.curi)+")</small>":n=t(n),"<div>"+n+"</div>"},option:function(e,t){return"<div>"+t(e.title||e.label||name.curi||e.name)+"<br/><small>("+t(e.URI)+")</small></div>"},option_create:function(e,n){var r=t.ontologyManager.uriDenormalize(e.input);return r!=e.input?'<div class="create">Add <strong>'+n(e.input)+"</strong> <small>("+n(r)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+n(r)+"</strong>&hellip;</div>"}}}),s=i[0].selectize;else{var u=t.ontologyManager.ontologyClassByURI(e),a=u?u.label:RDFE.Utils.uri2name(e);t.formContainer.html('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Add new Entity</h3></div><div class="panel-body"><div class="form-horizontal">   <div class="form-group">     <label for="class" class="col-sm-2 control-label">Type</label>     <div class="col-sm-10">       <p class="form-control-static" title="'+e+'">'+a+"</p>"+"    </div> "+"  </div> "+'  <div class="form-group"> '+'     <label for="subject" class="col-sm-2 control-label">Entity URI</label> '+'     <div class="col-sm-10"> '+'       <input name="subject" id="subject" class="form-control" /> '+"     </div> "+"  </div> "+'  <div class="form-group"> '+'    <div class="col-sm-10 col-sm-offset-2"> '+'      <a href="#" class="btn btn-default triple-action triple-action-new-cancel">Cancel</a> '+'      <a href="#" class="btn btn-primary triple-action triple-action-new-save">OK</a> '+"    </div> "+"  </div> "+"</div></div></div>\n"),t.formContainer.find("input#subject").focus()}this.config.options.entityUriTmpl&&t.formContainer.find('label[for="subject"]').text("Entity Name"),t.formContainer.find("a.triple-action-new-cancel").click(function(e){t.listContainer.show(),t.formContainer.hide()});var f=function(){var n=t.formContainer.find('input[name="subject"]').val(),r=null,i=e||t.formContainer.find("#class")[0].selectize.getValue();t.config.options.entityUriTmpl&&(r=n,n=null),t.doc.addEntity(n,r,i,function(e){t.entityView&&t.entityView.addEntity(e),$(t).trigger("rdf-editor-success",{type:"entity-insert-success",message:"Successfully created new entity."}),t.editEntity(e.uri)},function(){$(t).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new triple to store."})})};t.formContainer.find("a.triple-action-new-save").click(function(e){f()}),t.formContainer.find("input#subject").keypress(function(e){e.which===13&&f()})},RDFE.Editor.prototype.createEntityList=function(){var e=this;$(e).trigger("rdf-editor-start",{id:"render-entity-list",message:"Loading Entities..."}),e.entityView||(e.entityView=new RDFE.EntityView(this.doc,this.ontologyManager,{editFct:function(t){e.editEntity.call(e,t)}}),$(e.entityView).on("rdf-editor-error",function(t){$(e).trigger("rdf-editor-error",d)}).on("rdf-editor-success",function(t,n){$(e).trigger("rdf-editor-success",n)})),e.formContainer.hide(),e.listContainer.empty().show(),e.entityView.render(e.listContainer,function(){$(e).trigger("rdf-editor-done",{id:"render-entity-list"})})},RDFE.Editor.prototype.editEntity=function(e){var t=this;t.entityEditor||(t.entityEditor=new RDFE.EntityEditor(t.doc,t.ontologyManager),$(t.entityEditor).on("rdf-editor-error",function(e){$(t).trigger("rdf-editor-error",d)}).on("rdf-editor-success",function(e,n){$(t).trigger("rdf-editor-success",n)})),t.listContainer.hide(),t.formContainer.show(),t.entityEditor.render(t.formContainer,e,function(){t.formContainer.hide(),t.listContainer.show(),t.entityView.updateEntity(e)})}